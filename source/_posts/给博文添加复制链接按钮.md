---
title: 给博文添加复制链接按钮
top_img: false
cover: 'https://image.kmar.top/bg/b39.jpg!/fw/550'
abbrlink: e1e77a4d
date: 2022-02-14 14:58:53
categories:
  - 随心记
tags:
  - hexo
  - 魔改
description: 现在的分享按钮实在是有些鸡肋，点分享还需要手机扫码，甚至手机点还需要扫码分享，所以干脆弄个按钮点击复制链接好了。
---
  
## 注意

&emsp;&emsp;该博文是基于`Butterfly`主题修改的，不跟我一个主题的不要照搬我添加元素的方法。

&emsp;&emsp;本人没有学过前端知识，所以有一些名词可能会用错或者有这个名词但是我不知道，还请各位谅解。

## 缘由

&emsp;&emsp;想要做这个魔改的原因一方面是QQ的分享太过反人类，另一方面是我发现有些浏览器（比如我正在用的）在使用PWA浏览网页时打不开地址栏，这时候想要复制链接简直是难之又难。所以一直想要加一个复制链接的按钮，但是又不会加{% inlineimage https://image.kmar.top/icon/bili/wul.png %}。正巧，前段时间看到了群友写的一篇教程，我就在他的基础上修改了一些内容，就有了这篇博文。

## 魔改步骤

### 添加按钮

&emsp;&emsp;打开`[butterfly]\layout\includes\third-party\share\index.pug`，修改如下：

```diff
  .post_share
+   .copybtn(title='复制链接')
+     i.fas.fa-link
    if theme.addThis.enable
      !=partial('includes/third-party/share/add-this', {}, {cache: true})
    else if theme.sharejs.enable
      include ./share-js.pug
    else if theme.addtoany.enable
      !=partial('includes/third-party/share/addtoany', {}, {cache: true})
```

### 添加JS

&emsp;&emsp;对于偷懒的同学，可以在主题配置文件里面的`inject:head`里直接添加如下内容，`CDN`可以自行切换：

```
- <script async src="https://cdn.jsdelivr.net/gh/EmptyDreams/resources/shares/share.min.js"></script>
```

&emsp;&emsp;想把东西部署在本地的也可以直接把上面的JS下载下来部署，JS在`878`行开始是我写的内容，前面都是`clipboard`的源码。

---

## 原理介绍

### 向剪切板添加数据

&emsp;&emsp;想要向剪切板添加数据有多种办法，我们这里不再多说，只说一下今天的主角：`clipboard`。

&emsp;&emsp;第一步肯定是引入`clipboard`的JS啦，`clipboard`官方已经给出了[几个常用的CDN](https://github.com/zenorocha/clipboard.js/wiki/CDN-Providers)。

&emsp;&emsp;然后，我们需要给`clipboard`绑定一个页面元素，用来让`clipboard`添加鼠标点击的监视。是的，我们不需要手动添加鼠标监视然后调用`clipboard`的方法，我们只需要把这些事情统统交给`clipboard`就可以了。

&emsp;&emsp;现在我们创建一个按钮：

```html
<div class="copybtn" title="复制链接">
    <i class="fas fa-link"></i>
</div>
```

&emsp;&emsp;然后通过JS调用`clipboard`，构造函数的第一个参数就是要监视的元素的名称：

```javascript
new ClipboardJS('.btn', {
    text: function () {
        return "这里写要复制的内容"
    }
});
```

&emsp;&emsp;调用`clipboard`方法有很多，我们只说明这一种方法，具体用法自行查看[官方文档](https://clipboardjs.com/)。

### 弹窗提醒

&emsp;&emsp;现在我们想要在复制成功/失败的时候弹窗提醒用户，这时候就用到了`clipboard`提供的两个事件：

```javascript
clipboard.on('success', function () {
    /* 复制成功时触发 */
});
clipboard.on('error', function () {
    /* 复制失败时触发 */
});
```

&emsp;&emsp;对于`butterfly`主题，我们可以使用`btf.snackbarShow("text")`来弹出提示框。

## Ajax适配

&emsp;&emsp;如果你是完全按照我的方法走的，就没有与`ajax`的兼容问题，但是如果你用其它方法引入JS并且你开启了`ajax`，那么请务必注意与`ajax`的兼容问题。